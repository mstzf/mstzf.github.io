<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>树莓派开启个人热点 | TeohZY</title><meta name="author" content="TeohZY"><meta name="copyright" content="TeohZY"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="将树莓派作为软路由，能够方便的将网络分发出去，在没有其他热点的时候，会是一个不错的选择。"><meta property="og:type" content="article"><meta property="og:title" content="树莓派开启个人热点"><meta property="og:url" content="https://blog.teohzy.com/posts/startAP/index.html"><meta property="og:site_name" content="TeohZY"><meta property="og:description" content="将树莓派作为软路由，能够方便的将网络分发出去，在没有其他热点的时候，会是一个不错的选择。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://pic.mstzf.cn//blog/202202091916889.png"><meta property="article:published_time" content="2022-02-09T19:01:44.000Z"><meta property="article:modified_time" content="2022-02-09T19:01:44.000Z"><meta property="article:author" content="TeohZY"><meta property="article:tag" content="树莓派"><meta property="article:tag" content="个人热点"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://pic.mstzf.cn//blog/202202091916889.png"><link rel="shortcut icon" href="https://pic.mstzf.cn/wallpaper/logo.ico"><link rel="canonical" href="https://blog.teohzy.com/posts/startAP/index.html"><link rel="preconnect" href="//cdnjs.cloudflare.com"><meta name="google-site-verification" content="OWjlPfKEvE0ywO1BjwzVZyzw0xkNg-VUd-XymbY0EeA"><meta name="msvalidate.01" content="9565AFED5E9E8A24241BB5E6223CCB04"><meta name="baidu-site-verification" content="codeva-gkkGjNV6tZ"><meta name="360-site-verification" content="0995f688243005431c735f099560606d"><meta name="sogou_site_verification" content="t3iUouiDLt"><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/node-snackbar/0.1.16/snackbar.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.33/fancybox/fancybox.min.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={root:"/",algolia:{appId:"T6QJCHEEB6",apiKey:"a0bafb43e9184c629893a05ea6de3600",indexName:"dev_Search",hits:{per_page:6},languages:{input_placeholder:"搜索文章",hits_empty:"找不到您查询的内容：${query}",hits_stats:"找到 ${hits} 条结果，用时 ${time} 毫秒"}},localSearch:void 0,translate:void 0,noticeOutdate:void 0,highlight:{plugin:"highlight.js",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:250},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,post:!1},runtime:"天",dateSuffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:void 0,lightbox:"fancybox",Snackbar:{chs_to_cht:"你已切换为繁体中文",cht_to_chs:"你已切换为简体中文",day_to_night:"你已切换为深色模式",night_to_day:"你已切换为浅色模式",bgLight:"#49b1f5",bgDark:"#1f1f1f",position:"top-center"},infinitegrid:{js:"https://cdnjs.cloudflare.com/ajax/libs/egjs-infinitegrid/4.11.1/infinitegrid.min.js",buttonText:"加载更多"},isPhotoFigcaption:!1,islazyload:!0,isAnchor:!1,percent:{toc:!0,rightside:!0},autoDarkmode:!1}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"树莓派开启个人热点",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2022-02-09 19:01:44"}</script><script>(e=>{e.saveToLocal={set:(e,t,o)=>{if(0===o)return;const a={value:t,expiry:Date.now()+864e5*o};localStorage.setItem(e,JSON.stringify(a))},get:e=>{const t=localStorage.getItem(e);if(!t)return;const o=JSON.parse(t);if(!(Date.now()>o.expiry))return o.value;localStorage.removeItem(e)}},e.getScript=(e,t={})=>new Promise(((o,a)=>{const n=document.createElement("script");n.src=e,n.async=!0,n.onerror=a,n.onload=n.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,o())},Object.keys(t).forEach((e=>{n.setAttribute(e,t[e])})),document.head.appendChild(n)})),e.getCSS=(e,t=!1)=>new Promise(((o,a)=>{const n=document.createElement("link");n.rel="stylesheet",n.href=e,t&&(n.id=t),n.onerror=a,n.onload=n.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,o())},document.head.appendChild(n)})),e.activateDarkMode=()=>{document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},e.activateLightMode=()=>{document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};const t=saveToLocal.get("theme");"dark"===t?activateDarkMode():"light"===t&&activateLightMode();const o=saveToLocal.get("aside-status");void 0!==o&&("hide"===o?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})(window)</script><link rel="stylesheet" href="/self/css/post.css" media="defer" onload='this.media="all"'><link rel="stylesheet" href="/self/css/custom.css" media="defer" onload='this.media="all"'><link rel="stylesheet" href="/self/css/twikoo.css" media="defer" onload='this.media="all"'><link rel="stylesheet" href="/self/css/font.css" media="defer" onload='this.media="all"'><link rel="stylesheet" href="/self/css/about.css" media="defer" onload='this.media="all"'><meta name="generator" content="Hexo 7.1.1"></head><body><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><div class="loading-img"></div><div class="loading-image-dot"></div></div></div><script>const preloader={endLoading:()=>{document.body.style.overflow="auto",document.getElementById("loading-box").classList.add("loaded")},initLoading:()=>{document.body.style.overflow="",document.getElementById("loading-box").classList.remove("loaded")}};window.addEventListener("load",(()=>{preloader.endLoading()})),document.addEventListener("pjax:send",(()=>{preloader.initLoading()})),document.addEventListener("pjax:complete",(()=>{preloader.endLoading()}))</script><script>window.paceOptions={restartOnPushState:!1},document.addEventListener("pjax:send",(()=>{Pace.restart()}))</script><link rel="stylesheet" href="/self/css/progress_bar.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js"></script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://pic.mstzf.cn/wallpaper/TouX.jpg" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">39</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">41</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">40</div></a></div><hr class="custom-hr"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw iconfont icon-shouye-shouye"></i> <span>首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw iconfont icon-16"></i> <span>文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw iconfont icon-icon_guidang_2"></i> <span>归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw iconfont icon-biaoqian"></i> <span>标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw iconfont icon-wenzhangfenlei"></i> <span>分类</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw iconfont icon-dilanxianxingiconyihuifu_huabanfuben"></i> <span>交友</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/leaveWords"><i class="fa-fw iconfont icon-liuyan"></i> <span>留言板</span></a></li><li><a class="site-page child" href="/link/"><i class="fa-fw iconfont icon-youqinglianjie"></i> <span>友情链接</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw iconfont icon-guanyu"></i> <span>关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url('https://pic.mstzf.cn//blog/202202091904882.png')"><nav id="nav"><span id="blog-info"><a href="/" title="TeohZY"><span class="site-name">TeohZY</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i> <span>搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw iconfont icon-shouye-shouye"></i> <span>首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw iconfont icon-16"></i> <span>文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw iconfont icon-icon_guidang_2"></i> <span>归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw iconfont icon-biaoqian"></i> <span>标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw iconfont icon-wenzhangfenlei"></i> <span>分类</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw iconfont icon-dilanxianxingiconyihuifu_huabanfuben"></i> <span>交友</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/leaveWords"><i class="fa-fw iconfont icon-liuyan"></i> <span>留言板</span></a></li><li><a class="site-page child" href="/link/"><i class="fa-fw iconfont icon-youqinglianjie"></i> <span>友情链接</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw iconfont icon-guanyu"></i> <span>关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">树莓派开启个人热点</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-02-09T19:01:44.000Z" title="发表于 2022-02-09 19:01:44">2022-02-09</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-02-09T19:01:44.000Z" title="更新于 2022-02-09 19:01:44">2022-02-09</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%A0%91%E8%8E%93%E6%B4%BE/">树莓派</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%A0%91%E8%8E%93%E6%B4%BE/%E4%B8%AA%E4%BA%BA%E7%83%AD%E7%82%B9/">个人热点</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>12分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/posts/startAP/#post-comment"><span id="twikoo-count"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="更新软件"><a href="#更新软件" class="headerlink" title="更新软件"></a>更新软件</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$sudo apt update</span><br><span class="line">$sudo apt upgrade</span><br></pre></td></tr></table></figure><h2 id="安装并配置hostapd服务"><a href="#安装并配置hostapd服务" class="headerlink" title="安装并配置hostapd服务"></a>安装并配置hostapd服务</h2><h3 id="安装hostapd"><a href="#安装hostapd" class="headerlink" title="安装hostapd"></a>安装hostapd</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$sudo apt install hostapd</span><br><span class="line">$sudo systemctl stop hostapd</span><br></pre></td></tr></table></figure><h3 id="配置hostapd"><a href="#配置hostapd" class="headerlink" title="配置hostapd"></a>配置hostapd</h3><p>编辑&#x2F;etc&#x2F;hostapd&#x2F;hostapd.conf文件，如果不存在这个文件可以直接新建一个。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sudo vim /etc/hostapd/hostapd.conf</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br></pre></td><td class="code"><pre><span class="line">interface=wlan0</span><br><span class="line">#bridge=br0</span><br><span class="line">#无线驱动n180211</span><br><span class="line">driver=nl80211</span><br><span class="line">logger_syslog=-1</span><br><span class="line">logger_syslog_level=2</span><br><span class="line">logger_stdout=-1</span><br><span class="line">logger_stdout_level=2</span><br><span class="line">##### IEEE 802.11 related configuration #######################################</span><br><span class="line">#热点名字，可根据需要自行更改</span><br><span class="line">ssid=AP-Pi4</span><br><span class="line"></span><br><span class="line">utf8_ssid=1</span><br><span class="line"># ISO/IEC 3166-1 标准的国家代码，用于设置监管域。根据需要设置，按照哪个国家来操作设备。</span><br><span class="line"># 这可以限制可用的频道和发射功率。</span><br><span class="line">#country_code=CN</span><br><span class="line"># 是否启用 IEEE 802.11d，0 禁用（默认），1 启用。</span><br><span class="line"># 需要正确设置 country_code 才能使 IEEE 802.11d 正常工作。</span><br><span class="line">#ieee80211d=1</span><br><span class="line"># 是否启用 IEEE 802.11h，0 禁用（默认），1 启用。</span><br><span class="line"># 这将启用雷达探测和 DFS 支持，如果可用话。</span><br><span class="line">#ieee80211h=1</span><br><span class="line"># 添加 Power Constraint element 到 Beacon 和 Probe Response frames 中去。</span><br><span class="line">#local_pwr_constraint=5</span><br><span class="line"># 该选项仅在 ieee80211h=1 选项并且已经配置 local_pwr_constraint 选项时可用。</span><br><span class="line">#spectrum_mgmt_required=1</span><br><span class="line"># 设置无线模式需要硬件支持</span><br><span class="line">#a = IEEE 802.11a,</span><br><span class="line">#b = IEEE 802.11b, g</span><br><span class="line">#= IEEE 802.11g, </span><br><span class="line">#ad = IEEE 802.11ad (60 GHz)</span><br><span class="line"># hw_mode=a 或 hw_mode=g 选项也与 IEEE 802.11n 一起使用来设置波段。</span><br><span class="line"># 当使用 ACS 时(看下文 channel parameter )，可以使用特殊的选项值 hw_mode=any ，说明可以使用任何可用的波段，该值当前仅在驱动使用了 offloaded ACS 的情况下有效。</span><br><span class="line"># 默认: hw_mode=b</span><br><span class="line">hw_mode=g</span><br><span class="line"># 注意有些设备不使用这个选项，而是需要在 iwconfig 中另外配置。</span><br><span class="line"># 如果编译的时候启用了 CONFIG_ACS 选项。通过设置 channel=acs_survey 或 channel=0，这样 hostapd 可以在运行时基于 ACS survey 算法自动选择合适的信道。</span><br><span class="line"># 有些设备仅支持最大为11频道，有些支持最大为13频道，可以通过iw list 查看。</span><br><span class="line"># 另外启用 ht_capab 将影响可用的频道数</span><br><span class="line">channel=6</span><br><span class="line"># ACS tuning - 信道自动选择</span><br><span class="line"># 参考：http://wireless.kernel.org/en/users/Documentation/acs</span><br><span class="line"># 信道自动选择，有助于选择更好的信道，但是会增加启动时间，一般不需要修改。</span><br><span class="line"># 可以通过设置下面选项自定义 ACS survey 算法。</span><br><span class="line"># 默认：acs_num_scans=5  acs_chan_bias=1:0.8 6:0.8 11:0.8</span><br><span class="line">#acs_num_scans=40</span><br><span class="line">#acs_chan_bias=1:0.8 6:0.8 11:0.8</span><br><span class="line"># 默认允许所有信道</span><br><span class="line">#chanlist=100 104 108 112 116</span><br><span class="line">#chanlist=1 6 11-13</span><br><span class="line"># beacon 间隔  （默认: 100; 范围 15到65535）</span><br><span class="line">#beacon_int=100</span><br><span class="line">#dtim_period=1</span><br><span class="line"># 默认且最大值为2007个列表</span><br><span class="line">#max_num_sta=255</span><br><span class="line">#rts_threshold=2347</span><br><span class="line">#fragm_threshold=2346</span><br><span class="line">#supported_rates=10 20 55 110 60 90 120 180 240 360 480 540</span><br><span class="line">#basic_rates=10 20</span><br><span class="line">#basic_rates=10 20 55 110</span><br><span class="line">#basic_rates=60 120 240</span><br><span class="line"># 用命令：iw list 查看无线网卡是否有“short preamble supported”。</span><br><span class="line"># 0 禁用，1 启用，无线网卡支持的话可以启用以改善网络性能。</span><br><span class="line">#preamble=1</span><br><span class="line"></span><br><span class="line"># 无线MAC地址过滤</span><br><span class="line"># 此选项要求 driver=hostap 或 driver=nl80211</span><br><span class="line"># 0 = 接受所有连接，仅拒绝 deny 列表中的连接</span><br><span class="line"># 1 = 拒绝所有连接，仅接受 accept 列表中的连接</span><br><span class="line"># 2 = 使用外部 RADIUS 服务器 (还是会优先查找 accept/deny 列表)</span><br><span class="line"># 简单一点的话，可以将两个列表设置为同一个文件，仅由 macaddr_acl 来控制允许或拒绝</span><br><span class="line">macaddr_acl=0</span><br><span class="line">accept_mac_file=/etc/hostapd/hostapd.accept</span><br><span class="line">deny_mac_file=/etc/hostapd/hostapd.deny</span><br><span class="line"># 身份验证算法，1 开放系统认证，2 共享密钥认证(需要 WEP)，3 两者</span><br><span class="line"></span><br><span class="line">auth_algs=3</span><br><span class="line"># 是否广播，0 广播SSID，1 不广播SSID（发送空SSID，即长度为0的SSID），</span><br><span class="line"># 2 忽略广播 SSID 的探测请求，跟1类似，但是兼容某些不支持空SSID的设备</span><br><span class="line">#ignore_broadcast_ssid=0</span><br><span class="line">#vendor_elements=dd0411223301</span><br><span class="line"># 启用WMM</span><br><span class="line">wmm_enabled=1</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># WMM-PS Unscheduled Automatic Power Save Delivery [U-APSD]</span><br><span class="line"># Enable this flag if U-APSD supported outside hostapd (eg., Firmware/driver)</span><br><span class="line">#uapsd_advertisement_enabled=1</span><br><span class="line">#</span><br><span class="line"># Low priority / AC_BK = background</span><br><span class="line">#wmm_ac_bk_cwmin=4</span><br><span class="line">#wmm_ac_bk_cwmax=10</span><br><span class="line">#wmm_ac_bk_aifs=7</span><br><span class="line">#wmm_ac_bk_txop_limit=0</span><br><span class="line">#wmm_ac_bk_acm=0</span><br><span class="line"># Note: for IEEE 802.11b mode: cWmin=5 cWmax=10</span><br><span class="line">#</span><br><span class="line"># Normal priority / AC_BE = best effort</span><br><span class="line">#wmm_ac_be_aifs=3</span><br><span class="line">#wmm_ac_be_cwmin=4</span><br><span class="line">#wmm_ac_be_cwmax=10</span><br><span class="line">#wmm_ac_be_txop_limit=0</span><br><span class="line">#wmm_ac_be_acm=0</span><br><span class="line"># Note: for IEEE 802.11b mode: cWmin=5 cWmax=7</span><br><span class="line">#</span><br><span class="line"># High priority / AC_VI = video</span><br><span class="line">#wmm_ac_vi_aifs=2</span><br><span class="line">#wmm_ac_vi_cwmin=3</span><br><span class="line">#wmm_ac_vi_cwmax=4</span><br><span class="line">#wmm_ac_vi_txop_limit=94</span><br><span class="line">#wmm_ac_vi_acm=0</span><br><span class="line"># Note: for IEEE 802.11b mode: cWmin=4 cWmax=5 txop_limit=188</span><br><span class="line">#</span><br><span class="line"># Highest priority / AC_VO = voice</span><br><span class="line">#wmm_ac_vo_aifs=2</span><br><span class="line">#wmm_ac_vo_cwmin=2</span><br><span class="line">#wmm_ac_vo_cwmax=3</span><br><span class="line">#wmm_ac_vo_txop_limit=47</span><br><span class="line">#wmm_ac_vo_acm=0</span><br><span class="line"># Note: for IEEE 802.11b mode: cWmin=3 cWmax=4 burst=102</span><br><span class="line"># 检测客户端不活动超时,是否在线间隔时间,默认每5分钟检测客户端是否在线</span><br><span class="line"># 站点不活动限制，默认5分钟</span><br><span class="line">#ap_max_inactivity=300</span><br><span class="line"># 默认禁用，设置为1,说明只要客户在5分钟内没有活动就断线,即使客户端仍然在AP信号的范围内，</span><br><span class="line">#如果客户端过多可以启用来提高带机量。</span><br><span class="line">#skip_inactivity_poll=0</span><br><span class="line"># 对于过度的传输失败或其他连接丢失的情况下，断开连接，这并不适合所有设备</span><br><span class="line">#disassoc_low_ack=1</span><br><span class="line"># 最大允许侦听间隔，默认65535,即不限制 (how many Beacon periods STAs are allowed to remain asleep)</span><br><span class="line">#max_listen_interval=100</span><br><span class="line"># WDS(4-address frame)模式，仅在 driver=nl80211 的情况下支持</span><br><span class="line">#wds_sta=1</span><br><span class="line"># 仅在设置了bridge= 时有效，默认情况下，例如当设置了bridge=br0，那么wds_bridge=br0。</span><br><span class="line"># 当然也可以手动指定为wds_bridge=XXXXX。</span><br><span class="line">#wds_bridge=wds-br0</span><br><span class="line"># Start the AP with beaconing disabled by default.没明白是什么意思。</span><br><span class="line">#start_disabled=0</span><br><span class="line"># AP隔离，1启用，0禁用。默认不隔离。</span><br><span class="line">#ap_isolate=1</span><br><span class="line">#bss_load_update_period=50</span><br><span class="line"># 用于测试的</span><br><span class="line">#bss_load_test=12:80:20000</span><br><span class="line">##### IEEE 802.11n related configuration ######################################</span><br><span class="line"># 启用80211n，你也将需要启用WMM来使用全部HT功能。</span><br><span class="line">ieee80211n=1</span><br><span class="line"># [HT40-]或[HT40+]没有设置的话将只工作在20MHz，</span><br><span class="line"># [HT40-]对应可使用的频道为5-13</span><br><span class="line"># [HT40+]对应可使用的频道为1-7（欧洲标准为1-9）</span><br><span class="line"># 当多径效应不是很严重时，用户可以将该间隔配置为[SHORT-GI-20][SHORT-GI-40]</span><br><span class="line"># 个人理解，如果不上天馈系统的话可以启用[SHORT-GI-20][SHORT-GI-40]，前提是硬件支持。</span><br><span class="line">#ht_capab=[LDPC][HT40-][HT40+][SHORT-GI-20][SHORT-GI-40][SMPS-DYNAMIC][GF][TX-STBC][RX-STBC123][DELAYED-BA][MAX-AMSDU-7935][DSSS_CCK-40][40-INTOLERANT][LSIG-TXOP-PROT]</span><br><span class="line"># intel Wireless-N 105 (rev c4) 网卡支持的选项</span><br><span class="line">ht_capab=[HT40-][SHORT-GI-20][SHORT-GI-40][DSSS_CCK-40][40-INTOLERANT][GF]</span><br><span class="line"># Atheros AR9271 网卡支持的选项</span><br><span class="line">#ht_capab=[HT40-][SHORT-GI-20][SHORT-GI-40][DSSS_CCK-40][40-INTOLERANT][RX-STBC1]</span><br><span class="line">#ht_capab=[HT40-][SHORT-GI-20][SHORT-GI-40][DSSS_CCK-40]</span><br><span class="line">#ht_capab=[HT40-][SHORT-GI-20][SHORT-GI-40]</span><br><span class="line">#ht_capab=[HT40+][DSSS_CCK-40][40-INTOLERANT]</span><br><span class="line"># 强制要求客户端使用HT PHY，不使用就拒绝。</span><br><span class="line">#require_ht=0</span><br><span class="line"># 间隔时间（秒）</span><br><span class="line">#obss_interval=5</span><br><span class="line">##### WPA/IEEE 802.11i configuration ##########################################</span><br><span class="line"># 1 wpa，2 wpa2, 3 两者。 新的设备可以设置为2，仅使用wpa2版本。</span><br><span class="line">wpa=2</span><br><span class="line"></span><br><span class="line"># 指定密码，ASCII码或密码字符。</span><br><span class="line">#wpa_psk=0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef</span><br><span class="line">#密码设置</span><br><span class="line">wpa_passphrase=12345678</span><br><span class="line"># 使用密码文件，可以跟客户端MAC地址绑定设置不同的密码，比较实用。</span><br><span class="line">wpa_psk_file=/etc/hostapd/hostapd.wpa_psk</span><br><span class="line"># 是否使用验证服务器，0 禁用（默认），1 可用，2 强制使用（其他方式将拒绝）</span><br><span class="line">#wpa_psk_radius=0</span><br><span class="line"># 设置密钥管理算法WPA-PSK WPA-EAP或两者</span><br><span class="line">wpa_key_mgmt=WPA-PSK</span><br><span class="line"># 设置加密算法，CCMP就是AES，不推荐使用TKIP，除非设备不支持。</span><br><span class="line">wpa_pairwise=CCMP</span><br><span class="line"># 默认情况下rsn_pairwise自动设置为wpa_pairwise的值，当然也可以手动指定。</span><br><span class="line">#rsn_pairwise=CCMP</span><br><span class="line">#wpa_group_rekey=600</span><br><span class="line">#wpa_strict_rekey=1</span><br><span class="line">#wpa_gmk_rekey=86400</span><br><span class="line">#wpa_ptk_rekey=600</span><br><span class="line"># 预认证</span><br><span class="line">#rsn_preauth=1</span><br><span class="line">#rsn_preauth_interfaces=wlp2s0 br0 enp3s0</span><br><span class="line">#peerkey=1</span><br><span class="line"># 80211w支持，0 禁用（默认），1 可选，2 强制使用（其他方式将拒绝） 有些网卡不支持</span><br><span class="line">#ieee80211w=1</span><br><span class="line"># AES-128-CMAC（默认） BIP-GMAC-128 BIP-GMAC-256 BIP-CMAC-256 四种</span><br><span class="line"># 一般通用设备都支持AES-128-CMAC，其他的不一定</span><br><span class="line">#group_mgmt_cipher=AES-128-CMAC</span><br><span class="line">#assoc_sa_query_max_timeout=1000</span><br><span class="line">#assoc_sa_query_retry_timeout=201</span><br><span class="line">#disable_pmksa_caching=0</span><br><span class="line">#okc=1</span><br><span class="line">#sae_anti_clogging_threshold=5</span><br><span class="line">#sae_groups=19 20 21 25 26</span><br><span class="line">##### IEEE 802.11r configuration ##############################################</span><br><span class="line"># Wi-Fi无线漫游标准</span><br><span class="line">#mobility_domain=a1b2</span><br><span class="line">#r0_key_lifetime=10000</span><br><span class="line">#r1_key_holder=000102030405</span><br><span class="line">#reassociation_deadline=1000</span><br><span class="line">#pmk_r1_push=1</span><br><span class="line">##### Neighbor table ##########################################################</span><br><span class="line">#ap_table_max_size=255</span><br><span class="line">#ap_table_expiration_time=3600</span><br><span class="line">##### IEEE 802.11v-2011 #######################################################</span><br><span class="line"># Wi-Fi节能版 </span><br><span class="line">#time_advertisement=2</span><br><span class="line">#time_zone=CST8</span><br><span class="line"># 下面三项有些网卡不支持</span><br><span class="line">#wnm_sleep_mode=1</span><br><span class="line">#bss_transition=1</span><br><span class="line">#proxy_arp=1</span><br></pre></td></tr></table></figure><p>为了便于使用，将注释去除 <strong>（所用协议较老，请参照最新版）</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">interface=wlan0</span><br><span class="line">driver=nl80211</span><br><span class="line">#修改名字</span><br><span class="line">ssid=AP-Pi4</span><br><span class="line">utf8_ssid=1</span><br><span class="line">hw_mode=g</span><br><span class="line">channel=7</span><br><span class="line">ieee80211n=1</span><br><span class="line">macaddr_acl=0</span><br><span class="line">auth_algs=1</span><br><span class="line">wmm_enabled=0</span><br><span class="line">wpa=2</span><br><span class="line">#密码设置</span><br><span class="line">wpa_passphrase=12345678</span><br><span class="line">wpa_key_mgmt=WPA-PSK</span><br><span class="line">wpa_pairwise=CCMP</span><br></pre></td></tr></table></figure><ul><li>ssid: WiFi 名称，8~64 个字符，最好用英文字母，不要出现特殊字符</li><li>hw_mode: WiFi 网络模式，一般填 <code>g</code> 即可，设备支持的话可以填 <code>a</code> 启用 5G 频段：<ul><li>a &#x3D; IEEE 802.11a (5 GHz)</li><li>b &#x3D; IEEE 802.11b (2.4 GHz)</li><li>g &#x3D; IEEE 802.11g (2.4 GHz)</li></ul></li><li>channel: 信道编号。如果上面配置了 <code>hw_mode=g</code> 使用 2.4G 频段，则一般填 <code>7</code> 即可。如果配置了 5G 频段，则信道编号有所不同，具体参考：<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E6%97%A0%E7%BA%BF%E5%B1%80%E5%9F%9F%E7%BD%91%E4%BF%A1%E9%81%93%E5%88%97%E8%A1%A8">无线局域网信道列表 - 维基百科，自由的百科全书 (wikipedia.org)</a></li><li>wpa_passphrase: WiFi 密码，最好用英文加数字，不要出现特殊字符</li></ul><p><strong>最新版配置文件</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">ssid=AP-Pi4</span><br><span class="line">wpa_passphrase=123456789</span><br><span class="line"></span><br><span class="line">country_code=US</span><br><span class="line"></span><br><span class="line">interface=wlan0</span><br><span class="line">driver=nl80211</span><br><span class="line"></span><br><span class="line">wpa=2</span><br><span class="line">wpa_key_mgmt=WPA-PSK</span><br><span class="line">wpa_pairwise=TKIP CCMP</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">macaddr_acl=0</span><br><span class="line"></span><br><span class="line">logger_syslog=0</span><br><span class="line">logger_syslog_level=4</span><br><span class="line">logger_stdout=-1</span><br><span class="line">logger_stdout_level=0</span><br><span class="line"></span><br><span class="line">hw_mode=a</span><br><span class="line"></span><br><span class="line">channel=36</span><br><span class="line"># N</span><br><span class="line">ieee80211n=1</span><br><span class="line">require_ht=1</span><br><span class="line">ht_capab=[MAX-AMSDU-3839][HT40+][SHORT-GI-20][SHORT-GI-40][DSSS_CCK-40]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># AC</span><br><span class="line">ieee80211ac=1</span><br><span class="line">#require_vht=1</span><br><span class="line">ieee80211d=0</span><br><span class="line">ieee80211h=0</span><br><span class="line">#vht_capab=[MAX-AMSDU-3839][SHORT-GI-80]</span><br><span class="line">#vht_oper_chwidth=1</span><br><span class="line">#vht_oper_centr_freq_seg0_idx=42</span><br><span class="line"></span><br><span class="line">#AX</span><br><span class="line">ieee80211ax=1</span><br><span class="line">he_su_beamformer=1</span><br><span class="line">he_su_beamformee=1</span><br><span class="line">he_mu_beamformer=1</span><br><span class="line">he_bss_color=5</span><br><span class="line">he_default_pe_duration=0</span><br><span class="line">he_basic_mcs_nss_set=2</span><br><span class="line">eap_server=0</span><br><span class="line">he_oper_chwidth=1</span><br><span class="line">he_oper_centr_freq_seg0_idx=42</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">wmm_enabled=1</span><br><span class="line">wmm_ac_bk_cwmin=4</span><br><span class="line">wmm_ac_bk_cwmax=10</span><br><span class="line">wmm_ac_bk_aifs=7</span><br><span class="line">wmm_ac_bk_txop_limit=0</span><br><span class="line">wmm_ac_bk_acm=0</span><br><span class="line">wmm_ac_be_aifs=3</span><br><span class="line">wmm_ac_be_cwmin=4</span><br><span class="line">wmm_ac_be_cwmax=10</span><br><span class="line">wmm_ac_be_txop_limit=0</span><br><span class="line">wmm_ac_be_acm=0</span><br><span class="line">wmm_ac_vi_aifs=2</span><br><span class="line">wmm_ac_vi_cwmin=3</span><br><span class="line">wmm_ac_vi_cwmax=4</span><br><span class="line">wmm_ac_vi_txop_limit=94</span><br><span class="line">wmm_ac_vi_acm=0</span><br><span class="line">wmm_ac_vo_aifs=2</span><br><span class="line">wmm_ac_vo_cwmin=2</span><br><span class="line">wmm_ac_vo_cwmax=3</span><br><span class="line">wmm_ac_vo_txop_limit=47</span><br><span class="line">wmm_ac_vo_acm=0</span><br></pre></td></tr></table></figure><p>编辑&#x2F;etc&#x2F;default&#x2F;hostapd文件，将DAEMON_CONF前面的注释去掉，并加上&#x2F;etc&#x2F;hostapd&#x2F;hostapd.conf</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://pic.mstzf.cn//blog/202202081507806.png" alt="image-20220208150739117"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$sudo vim /etc/default/hostapd</span><br><span class="line"></span><br><span class="line">DAEMON_CONF=&quot;/etc/hostapd/hostapd.conf&quot;</span><br></pre></td></tr></table></figure><p>保存退出后启动hostapd</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$sudo systemctl unmask hostapd</span><br><span class="line">$sudo systemctl enable hostapd</span><br><span class="line">$sudo systemctl start hostapd</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://pic.mstzf.cn//blog/202202081531235.png" alt="image-20220208153101418"></p><p>可以看到热点已经开启成功，但是还没有分配IP不能上网。</p><h2 id="配置wlan0静态IP"><a href="#配置wlan0静态IP" class="headerlink" title="配置wlan0静态IP"></a>配置wlan0静态IP</h2><p>让wlan0的IP地址设置成静态的，然后在通过DHCP同态的去给连接设备分配IP</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$sudo apt install dhcpcd</span><br><span class="line">$sudo vim /etc/dhcpcd.conf</span><br></pre></td></tr></table></figure><p>在文件最后添加</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">interface wlan0</span><br><span class="line">    static ip_address=192.168.4.1/24</span><br><span class="line">    nohook wpa_supplicant</span><br></pre></td></tr></table></figure><p>保存退出，重启dhcpcd服务：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sudo systemctl restart dhcpcd</span><br></pre></td></tr></table></figure><p>查看wlan0的IP地址：ifconfig ，可以发现，wlan0的IP已经改变为之前设置的地址</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://pic.mstzf.cn//blog/202202091603084.png" alt="image-20220209160315594"></p><h2 id="安装并配置dnsmasq服务"><a href="#安装并配置dnsmasq服务" class="headerlink" title="安装并配置dnsmasq服务"></a>安装并配置dnsmasq服务</h2><p>Dnsmasq 提供 DNS 缓存和 DHCP 服务功能。作为域名解析服务器(DNS)，dnsmasq可以通过缓存 DNS 请求来提高对访问过的网址的连接速度。作为DHCP 服务器，dnsmasq 可以用于为局域网电脑分配内网ip地址和提供路由。DNS和DHCP两个功能可以同时或分别单独实现。dnsmasq轻量且易配置，适用于个人用户或少于50台主机的网络。此外它还自带了一个 PXE 服务器。</p><h3 id="安装dnsmasq服务"><a href="#安装dnsmasq服务" class="headerlink" title="安装dnsmasq服务"></a>安装dnsmasq服务</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt install dnsmasq</span><br><span class="line">$ sudo systemctl stop dnsmasq</span><br></pre></td></tr></table></figure><h3 id="配置dnsmasq"><a href="#配置dnsmasq" class="headerlink" title="配置dnsmasq"></a>配置dnsmasq</h3><p>编辑&#x2F;etc&#x2F;dnsmasq.conf文件，将里面的内容删除或者注释掉。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/dnsmasq.conf</span><br><span class="line"></span><br><span class="line">#添加新内容</span><br><span class="line">interface=wlan0</span><br><span class="line">dhcp-range=192.168.4.2,192.168.4.20,255.255.255.0,24h</span><br><span class="line"></span><br><span class="line">#dhcp 服务会给客户端分配 192.168.4.2 到 192.168.4.20 的 IP 空间，并设置24 小时租期。</span><br><span class="line"></span><br><span class="line">#重启dnsmasq服务</span><br><span class="line">$sudo systemctl restart dnsmasq</span><br></pre></td></tr></table></figure><p>配置完后连接到热点已经自动分配到了一个IP地址，但是还不能上网</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://pic.mstzf.cn//blog/202202091621554.png" alt="image-20220209162149776"></p><h2 id="配置IP转发"><a href="#配置IP转发" class="headerlink" title="配置IP转发"></a>配置IP转发</h2><p>编辑 <code>/etc/sysctl.conf</code> 系统配置文件，将 <code>net.ipv4.ip_forward=1</code> 前面的注释去掉。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$sudo vim /etc/sysctl.conf</span><br><span class="line"></span><br><span class="line">#net.ipv4.ip_forward=1</span><br><span class="line">#将前面的 # 号删除</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://pic.mstzf.cn//blog/202202091628179.png" alt="image-20220209162842756"></p><h3 id="修改防火墙规则"><a href="#修改防火墙规则" class="headerlink" title="修改防火墙规则"></a>修改防火墙规则</h3><p>安装iptables</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install iptables</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE</span><br><span class="line">$sudo iptables -A FORWARD -i eth0 -o wlan0 -m state --state RELATED,ESTABLISHED -j ACCEPT</span><br><span class="line">$sudo iptables -A FORWARD -i wlan0 -o eth0 -j ACCEPT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">##若要通过热点建立NAS开启以下防火墙规则</span><br><span class="line">#sudo iptables -A INPUT -p tcp --dport 139 -j ACCEPT</span><br><span class="line">#sudo iptables -A OUTPUT -p tcp --sport 139 -j ACCEPT</span><br><span class="line">#sudo iptables -A INPUT -p tcp --dport 445 -j ACCEPT</span><br><span class="line">#sudo iptables -A OUTPUT -p tcp --sport 445 -j ACCEPT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>为了避免每次重启后都要重新配置，将防火墙规则写入开机启动项</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">将防火墙规则写入文件</span><br><span class="line">$sudo sh -c &quot;iptables-save &gt; /etc/iptables.ipv4.nat&quot;</span><br></pre></td></tr></table></figure><p>编辑<code>/etc/rc.local</code>，将<code>iptables-restore &lt; /etc/iptables.ipv4.nat</code>加到exit 0前面。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$sudo vim /etc/rc.local</span><br><span class="line">#加在exit 0前面</span><br><span class="line">iptables-restore &lt; /etc/iptables.ipv4.nat</span><br><span class="line">若执行后出现：sh: 1: iptables-save: not found</span><br><span class="line">要先安装iptables</span><br><span class="line">$sudo apt install iptables</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://pic.mstzf.cn//blog/202202091634498.png" alt="image-20220209163455762"></p><p>保存退出后重启树莓派：<code>sudo reboot</code>。</p><h2 id="网络测试"><a href="#网络测试" class="headerlink" title="网络测试"></a>网络测试</h2><p>经过一段时间的测试，能够正常访问互联网，网速也还可以，但是在流量较大时会间歇性断开连接，上传速率也有些异常，目前还不清楚是什么原因造成。**(已解决)**</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://pic.mstzf.cn//blog/202202091854457.png" alt="image-20220209185439101"></p><p><strong>网络慢问题分析及解决办法</strong></p><a class="tag-Link" target="_blank" href="/posts/startAP2/"><div class="tag-link-tips">引用站外地址,不保证站点的可用性和安全性</div><div class="tag-link-bottom"><div class="tag-link-left" style="background-image:url(https://api.iowen.cn/favicon//posts/startAP2/.png)"></div><div class="tag-link-right"><div class="tag-link-title">树莓派开启个人热点（二）解决网速慢问题</div><div class="tag-link-sitename">Mstzf</div></div><i class="fa-solid fa-angle-right"></i></div></a></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者:</span> <span class="post-copyright-info"><a href="https://blog.teohzy.com">TeohZY</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接:</span> <span class="post-copyright-info"><a href="https://blog.teohzy.com/posts/startAP/">https://blog.teohzy.com/posts/startAP/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明:</span> <span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://blog.teohzy.com" target="_blank">TeohZY</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%A0%91%E8%8E%93%E6%B4%BE/">树莓派</a><a class="post-meta__tags" href="/tags/%E4%B8%AA%E4%BA%BA%E7%83%AD%E7%82%B9/">个人热点</a></div><div class="post_share"><div class="social-share" data-image="https://pic.mstzf.cn//blog/202202091916889.png" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/butterfly-extsrc/1.1.3/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdnjs.cloudflare.com/ajax/libs/butterfly-extsrc/1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://pic.mstzf.cn/blog/202204221711621.png" target="_blank"><img class="post-qr-code-img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://pic.mstzf.cn/blog/202204221711621.png" alt="微信"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://pic.mstzf.cn/blog/202204221714688.jpg" target="_blank"><img class="post-qr-code-img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://pic.mstzf.cn/blog/202204221714688.jpg" alt="支付宝"></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/picture_host/" title="搭建一个个人的专属图床"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://pic.mstzf.cn//blog/202202142050640.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">搭建一个个人的专属图床</div></div></a></div><div class="next-post pull-right"><a href="/posts/windowsgcc/" title="Windows环境下安装gcc编译器"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://pic.mstzf.cn//blog/202202042307677.png" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Windows环境下安装gcc编译器</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/startAP2/" title="树莓派开启个人热点（二）解决网速慢问题"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://pic.mstzf.cn//blog/202202091916889.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-12</div><div class="title">树莓派开启个人热点（二）解决网速慢问题</div></div></a></div><div><a href="/posts/private_cloud_disk/" title="搭建私人云盘"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://pic.mstzf.cn//blog/202202192045602.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-19</div><div class="title">搭建私人云盘</div></div></a></div><div><a href="/posts/raspi-ec20/" title="树莓派+EC20模块实现连接蜂窝网和短信收发"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://pic.mstzf.cn/blog/202404081738280.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-04-08</div><div class="title">树莓派+EC20模块实现连接蜂窝网和短信收发</div></div></a></div><div><a href="/posts/hc-rsAndcamera/" title="树莓派64位系统实现对访客抓拍"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://pic.mstzf.cn/blog/202307091157322.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-07-09</div><div class="title">树莓派64位系统实现对访客抓拍</div></div></a></div><div><a href="/posts/smpxjfsyj/" title="树莓派开机自动发送邮件"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://pic.mstzf.cn/blog/202202041733290.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-30</div><div class="title">树莓派开机自动发送邮件</div></div></a></div><div><a href="/posts/raspi_samba_nas/" title="树莓派搭建文件共享系统（samba）"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://pic.mstzf.cn/blog/202204092341583.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-04-09</div><div class="title">树莓派搭建文件共享系统（samba）</div></div></a></div></div></div><hr class="custom-hr"><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i> <span>评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://pic.mstzf.cn/wallpaper/TouX.jpg" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info__name">TeohZY</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">39</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">41</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">40</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/mstzf"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/mstzf" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:mstzf@foxmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来到我的博客😁 这里主要记录博主个人的日常学习笔记，还有一些生活趣事😄 文章写的不是很好，也有很多错误🤓 欢迎大家交流评论🥰</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E8%BD%AF%E4%BB%B6"><span class="toc-number">1.</span> <span class="toc-text">更新软件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E5%B9%B6%E9%85%8D%E7%BD%AEhostapd%E6%9C%8D%E5%8A%A1"><span class="toc-number">2.</span> <span class="toc-text">安装并配置hostapd服务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85hostapd"><span class="toc-number">2.1.</span> <span class="toc-text">安装hostapd</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEhostapd"><span class="toc-number">2.2.</span> <span class="toc-text">配置hostapd</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEwlan0%E9%9D%99%E6%80%81IP"><span class="toc-number">3.</span> <span class="toc-text">配置wlan0静态IP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E5%B9%B6%E9%85%8D%E7%BD%AEdnsmasq%E6%9C%8D%E5%8A%A1"><span class="toc-number">4.</span> <span class="toc-text">安装并配置dnsmasq服务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85dnsmasq%E6%9C%8D%E5%8A%A1"><span class="toc-number">4.1.</span> <span class="toc-text">安装dnsmasq服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEdnsmasq"><span class="toc-number">4.2.</span> <span class="toc-text">配置dnsmasq</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEIP%E8%BD%AC%E5%8F%91"><span class="toc-number">5.</span> <span class="toc-text">配置IP转发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E9%98%B2%E7%81%AB%E5%A2%99%E8%A7%84%E5%88%99"><span class="toc-number">5.1.</span> <span class="toc-text">修改防火墙规则</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E6%B5%8B%E8%AF%95"><span class="toc-number">6.</span> <span class="toc-text">网络测试</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/raspi-ec20/" title="树莓派+EC20模块实现连接蜂窝网和短信收发"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://pic.mstzf.cn/blog/202404081738280.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="树莓派+EC20模块实现连接蜂窝网和短信收发"></a><div class="content"><a class="title" href="/posts/raspi-ec20/" title="树莓派+EC20模块实现连接蜂窝网和短信收发">树莓派+EC20模块实现连接蜂窝网和短信收发</a><time datetime="2024-04-08T17:28:32.000Z" title="发表于 2024-04-08 17:28:32">2024-04-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/undefined/" title="树莓派访客拍照C语言版"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://pic.mstzf.cn/blog/202307091157322.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="树莓派访客拍照C语言版"></a><div class="content"><a class="title" href="/posts/undefined/" title="树莓派访客拍照C语言版">树莓派访客拍照C语言版</a><time datetime="2024-02-17T15:53:10.000Z" title="发表于 2024-02-17 15:53:10">2024-02-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/mp-tower-swiper/" title="堆叠轮播图（color ui原生小程序代码优化)"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://pic.mstzf.cn/blog/202312262333185.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="堆叠轮播图（color ui原生小程序代码优化)"></a><div class="content"><a class="title" href="/posts/mp-tower-swiper/" title="堆叠轮播图（color ui原生小程序代码优化)">堆叠轮播图（color ui原生小程序代码优化)</a><time datetime="2023-12-26T23:09:48.000Z" title="发表于 2023-12-26 23:09:48">2023-12-26</time></div></div></div></div></div></div></main><footer id="footer" style="background-image:url('https://pic.mstzf.cn//blog/202202091904882.png')"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2024 By TeohZY</div><div class="framework-info"><span>框架</span> <a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题</span> <a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.33/fancybox/fancybox.umd.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/17.8.8/lazyload.iife.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/node-snackbar/0.1.16/snackbar.min.js"></script><script>function panguFn(){"object"==typeof pangu?pangu.autoSpacingPage():getScript("https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js").then((()=>{pangu.autoSpacingPage()}))}function panguInit(){panguFn()}document.addEventListener("DOMContentLoaded",panguInit)</script><div class="js-pjax"><script>(()=>{const e=document.querySelectorAll("#article-container .mermaid-wrap");if(0===e.length)return;const t=()=>{window.loadMermaid=!0;const t="dark"===document.documentElement.getAttribute("data-theme")?"dark":"default";Array.from(e).forEach(((e,n)=>{const d=e.firstElementChild,a="mermaid-"+n,r="%%{init:{ 'theme':'"+t+"'}}%%\n"+d.textContent,i=mermaid.render(a,r);var m;"string"==typeof i?(m=i,d.insertAdjacentHTML("afterend",m)):i.then((({svg:e})=>{d.insertAdjacentHTML("afterend",e)}))}))},n=()=>{window.loadMermaid?t():getScript("https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.8.0/mermaid.min.js").then(t)};btf.addGlobalFn("themeChange",t,"mermaid"),window.pjax?n():document.addEventListener("DOMContentLoaded",n)})()</script><script>(()=>{const t=()=>{twikoo.init(Object.assign({el:"#twikoo-wrap",envId:"https://twikoo.mstzf.cn",region:"",onCommentLoaded:()=>{btf.loadLightbox(document.querySelectorAll("#twikoo .tk-content img:not(.tk-owo-emotion)"))}},null)),GLOBAL_CONFIG_SITE.isPost&&(()=>{const t=document.getElementById("twikoo-count");t&&twikoo.getCommentsCount({envId:"https://twikoo.mstzf.cn",region:"",urls:[window.location.pathname],includeReply:!1}).then((o=>{t.textContent=o[0].count})).catch((t=>{console.error(t)}))})()},o=()=>{"object"==typeof twikoo?setTimeout(t,0):getScript("https://cdnjs.cloudflare.com/ajax/libs/twikoo/1.6.31/twikoo.all.min.js").then(t)};o()})()</script></div><script charset="UTF-8" id="LA_COLLECT" src="https://sdk.51.la/js-sdk-pro.min.js"></script><script src="https://sdk.51.la/perf/js-sdk-perf.min.js" crossorigin="anonymous"></script><script>LA.init({id:"Jv1zicUd8PkfXdBP",ck:"Jv1zicUd8PkfXdBP"})</script><script>(new LingQue.Monitor).init({id:"Jv22xg5SkTMl9Alt",sendSuspicious:!0})</script><script src="/self/js/twikoo.js"></script><script src="/self/js/custom.js"></script><div class="aplayer no-destroy" data-id="7081142816" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="false" data-order="random"></div><canvas class="fireworks" mobile="true"></canvas><script src="https://cdnjs.cloudflare.com/ajax/libs/butterfly-extsrc/1.1.3/fireworks.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/pjax/0.2.8/pjax.min.js"></script><script>let pjaxSelectors=["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"];var pjax=new Pjax({elements:'a:not([target="_blank"])',selectors:pjaxSelectors,cacheBust:!1,analytics:!1,scrollRestoration:!1});document.addEventListener("pjax:send",(function(){if(btf.removeGlobalFnEvent("pjax"),btf.removeGlobalFnEvent("themeChange"),document.getElementById("rightside").classList.remove("rightside-show"),window.aplayers)for(let e=0;e<window.aplayers.length;e++)window.aplayers[e].options.fixed||window.aplayers[e].destroy();"object"==typeof typed&&typed.destroy();const e=document.body.classList;e.contains("read-mode")&&e.remove("read-mode"),"object"==typeof disqusjs&&disqusjs.destroy()})),document.addEventListener("pjax:complete",(function(){window.refreshFn(),document.querySelectorAll("script[data-pjax]").forEach((e=>{const t=document.createElement("script"),o=e.text||e.textContent||e.innerHTML||"";Array.from(e.attributes).forEach((e=>t.setAttribute(e.name,e.value))),t.appendChild(document.createTextNode(o)),e.parentNode.replaceChild(t,e)})),GLOBAL_CONFIG.islazyload&&window.lazyLoadInstance.update(),"function"==typeof panguInit&&panguInit(),"function"==typeof gtag&&gtag("config","",{page_path:window.location.pathname}),"object"==typeof _hmt&&_hmt.push(["_trackPageview",window.location.pathname]),"function"==typeof loadMeting&&document.getElementsByClassName("aplayer").length&&loadMeting(),"object"==typeof Prism&&Prism.highlightAll()})),document.addEventListener("pjax:error",(e=>{404===e.request.status&&pjax.loadUrl("/404.html")}))</script><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div><script src="https://cdnjs.cloudflare.com/ajax/libs/algoliasearch/4.22.1/algoliasearch-lite.umd.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/instantsearch.js/4.65.0/instantsearch.production.min.js"></script><script src="/js/search/algolia.js?v=4.13.0"></script></div></div></body></html>